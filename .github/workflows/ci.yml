name: ci

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    name: ci
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Setup Deno
        uses: denoland/setup-deno@main
        with:
          deno-version: 1.x

      - name: Test
        run: deno test --config tsconfig.json extension.ts

      - name: Bundle
        run: deno bundle --config tsconfig.json extension.ts extension.js

      - name: Release
        # --no-check: https://github.com/octokit/octokit.js/issues/2075#issuecomment-830350826
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: deno run --no-check --allow-env --unstable release.ts
